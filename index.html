<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1a1a2e">
    <title>âš”ï¸ Guerra dos Reinos</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        :root {
            --gold: #DAA520;
            --gold-light: #FFD700;
            --gold-dark: #B8860B;
            --bg-deep: #0d0d1a;
            --bg-card: rgba(26, 20, 40, 0.97);
            --bg-card2: rgba(35, 28, 55, 0.95);
            --border: #3a2a5a;
            --text: #f0e6d3;
            --text-muted: #9988aa;
            --red: #c0392b;
            --green: #27ae60;
            --blue: #2980b9;
        }

        body {
            font-family: 'Crimson Text', Georgia, serif;
            background: var(--bg-deep);
            background-image:
                radial-gradient(ellipse at 20% 20%, rgba(90,40,120,0.15) 0%, transparent 60%),
                radial-gradient(ellipse at 80% 80%, rgba(180,120,0,0.08) 0%, transparent 60%);
            color: var(--text);
            min-height: 100vh;
            padding-bottom: 90px;
            font-size: 18px;
        }

        /* HEADER */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: linear-gradient(135deg, #2a1500 0%, #4a2800 50%, #2a1500 100%);
            padding: 18px 16px 14px;
            border-bottom: 3px solid var(--gold);
            box-shadow: 0 4px 24px rgba(0,0,0,0.7), 0 1px 0 rgba(218,165,32,0.3) inset;
        }

        .header-title {
            font-family: 'Cinzel', serif;
            font-size: 1.45em;
            font-weight: 900;
            color: var(--gold-light);
            text-align: center;
            letter-spacing: 0.05em;
            text-shadow: 0 0 20px rgba(255,215,0,0.4), 2px 2px 4px rgba(0,0,0,0.8);
            line-height: 1.2;
        }

        .header-sub {
            font-family: 'Crimson Text', serif;
            font-size: 0.95em;
            color: #d4b896;
            text-align: center;
            margin-top: 5px;
            font-style: italic;
            letter-spacing: 0.03em;
        }

        /* CONTENT */
        .content { padding: 16px 14px; max-width: 640px; margin: 0 auto; }

        .section-title {
            font-family: 'Cinzel', serif;
            font-size: 1.3em;
            font-weight: 700;
            color: var(--gold);
            margin-bottom: 18px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--gold-dark);
            letter-spacing: 0.04em;
        }

        /* LORD CARDS */
        .lord-card {
            background: var(--bg-card);
            padding: 18px;
            margin-bottom: 16px;
            border-radius: 12px;
            border: 2px solid;
            box-shadow: 0 4px 16px rgba(0,0,0,0.5);
            position: relative;
            transition: transform 0.2s;
        }

        .lord-card.expandable { cursor: pointer; }
        .lord-card.expandable:active { transform: scale(0.99); }

        .lord-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 14px;
        }

        .position-badge {
            width: 52px;
            height: 52px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Cinzel', serif;
            font-size: 1.5em;
            font-weight: 900;
            border: 3px solid var(--gold-dark);
            flex-shrink: 0;
        }

        .pos-1 { background: linear-gradient(135deg, #FFD700, #B8860B); color: #1a0a00; }
        .pos-2 { background: linear-gradient(135deg, #C0C0C0, #808080); color: #1a1a1a; }
        .pos-3 { background: linear-gradient(135deg, #CD7F32, #8B4513); color: #fff8f0; }
        .pos-n { background: rgba(60,50,80,0.8); color: #aaa; border-color: #4a3a6a; }

        .avatar { font-size: 3em; flex-shrink: 0; line-height: 1; }

        .lord-info { flex: 1; min-width: 0; }

        .lord-name {
            font-family: 'Cinzel', serif;
            font-size: 1.15em;
            font-weight: 700;
            color: var(--gold-light);
            margin-bottom: 4px;
            line-height: 1.2;
        }

        .lord-house {
            font-size: 0.95em;
            margin-bottom: 4px;
            font-weight: 600;
        }

        .lord-title {
            font-size: 0.88em;
            color: var(--gold);
            font-style: italic;
        }

        /* POINTS */
        .points-display {
            background: rgba(218,165,32,0.08);
            border: 1px solid rgba(218,165,32,0.2);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
            text-align: center;
        }

        .total-points {
            font-family: 'Cinzel', serif;
            font-size: 2.6em;
            font-weight: 900;
            color: var(--gold-light);
            line-height: 1;
            margin-bottom: 8px;
            text-shadow: 0 0 15px rgba(255,215,0,0.3);
        }

        .points-breakdown {
            display: flex;
            justify-content: center;
            gap: 20px;
            font-size: 1.05em;
            font-weight: 600;
            flex-wrap: wrap;
        }

        .pts-cartola { color: #4CAF50; }
        .pts-medieval-pos { color: var(--gold); }
        .pts-medieval-neg { color: #e74c3c; }

        /* STATS GRID */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            margin-bottom: 12px;
        }

        .stat-item {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.08);
            padding: 10px 8px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-label { font-size: 0.82em; color: var(--text-muted); margin-bottom: 4px; }
        .stat-value { font-family: 'Cinzel', serif; font-size: 1.3em; font-weight: 700; color: var(--gold-light); }
        .stat-value.negative { color: #e74c3c; }

        /* EXPAND */
        .lord-details { display: none; margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.1); }
        .lord-details.show { display: block; }

        .expand-btn {
            text-align: center;
            padding: 10px;
            font-size: 0.9em;
            color: var(--text-muted);
            background: rgba(255,255,255,0.04);
            border-radius: 7px;
            margin-top: 10px;
            font-style: italic;
        }

        .crown-icon { position: absolute; top: 12px; right: 12px; font-size: 2em; }

        /* BATTLE CARDS */
        .battle-card {
            background: var(--bg-card);
            padding: 18px;
            margin-bottom: 16px;
            border-radius: 12px;
            border: 2px solid #3a2040;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .battle-card:active { border-color: var(--gold-dark); }

        .battle-round {
            font-family: 'Cinzel', serif;
            font-size: 0.85em;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 4px;
        }

        .battle-name {
            font-family: 'Cinzel', serif;
            font-size: 1.1em;
            font-weight: 700;
            color: var(--gold-light);
            margin-bottom: 10px;
            line-height: 1.3;
        }

        .battle-winner {
            font-size: 1.05em;
            color: #4CAF50;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .battle-results { display: none; margin-top: 16px; padding-top: 16px; border-top: 1px solid #3a2a5a; }
        .battle-results.show { display: block; }

        .result-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin-bottom: 7px;
            border-radius: 8px;
            border: 1px solid;
        }

        .result-left { display: flex; align-items: center; gap: 10px; flex: 1; }
        .result-avatar { font-size: 1.8em; }
        .result-name { font-size: 1.05em; font-weight: 600; color: var(--gold-light); }
        .result-badges { font-size: 1em; margin-top: 3px; }
        .result-pts { font-family: 'Cinzel', serif; font-size: 1.25em; font-weight: 700; color: var(--gold-light); min-width: 70px; text-align: right; }

        /* HALL CARDS */
        .hall-card {
            padding: 24px;
            margin-bottom: 16px;
            border-radius: 14px;
            text-align: center;
            box-shadow: 0 6px 24px rgba(0,0,0,0.5);
        }

        .hall-avatar { font-size: 3.5em; margin-bottom: 10px; }
        .hall-category { font-family: 'Cinzel', serif; font-size: 1em; font-weight: 700; letter-spacing: 0.1em; margin-bottom: 8px; }
        .hall-name { font-family: 'Cinzel', serif; font-size: 1.4em; font-weight: 900; margin: 6px 0; }
        .hall-achievement { font-size: 1.15em; font-weight: 600; margin: 6px 0; }
        .hall-title { font-size: 0.95em; font-style: italic; margin-top: 8px; opacity: 0.9; }

        /* REGRAS */
        .rules-section { margin-bottom: 24px; }

        .rules-group-title {
            font-family: 'Cinzel', serif;
            font-size: 1.05em;
            font-weight: 700;
            color: var(--gold);
            padding: 10px 14px;
            background: rgba(218,165,32,0.1);
            border-left: 4px solid var(--gold);
            border-radius: 0 8px 8px 0;
            margin-bottom: 12px;
            letter-spacing: 0.03em;
        }

        .rules-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 16px;
            font-size: 1em;
        }

        .rules-table th {
            font-family: 'Cinzel', serif;
            font-size: 0.85em;
            color: var(--gold);
            text-align: left;
            padding: 8px 10px;
            border-bottom: 2px solid var(--gold-dark);
            letter-spacing: 0.05em;
        }

        .rules-table td {
            padding: 10px 10px;
            border-bottom: 1px solid rgba(255,255,255,0.06);
            vertical-align: middle;
        }

        .rules-table tr:last-child td { border-bottom: none; }

        .pts-pos { color: #4CAF50; font-family: 'Cinzel', serif; font-weight: 700; font-size: 1.1em; }
        .pts-neg { color: #e74c3c; font-family: 'Cinzel', serif; font-weight: 700; font-size: 1.1em; }
        .pts-bonus { color: var(--gold); font-family: 'Cinzel', serif; font-weight: 700; font-size: 1.1em; }

        .rule-note {
            background: rgba(218,165,32,0.07);
            border: 1px solid rgba(218,165,32,0.2);
            border-radius: 8px;
            padding: 12px 14px;
            font-size: 0.95em;
            color: #c8b89a;
            margin-bottom: 12px;
            font-style: italic;
            line-height: 1.5;
        }

        /* BOTTOM NAV */
        .bottom-nav {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            background: rgba(15, 10, 25, 0.98);
            border-top: 3px solid var(--gold-dark);
            display: flex;
            justify-content: space-around;
            padding: 8px 0 10px;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.6);
            z-index: 100;
        }

        .nav-btn {
            flex: 1;
            background: transparent;
            border: none;
            color: #5a4a7a;
            padding: 8px 4px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            font-family: 'Cinzel', serif;
            font-size: 0.72em;
            font-weight: 700;
            letter-spacing: 0.05em;
            transition: color 0.2s;
            min-height: 56px;
        }

        .nav-btn.active { color: var(--gold); }
        .nav-btn.active .nav-icon { filter: drop-shadow(0 0 6px rgba(255,215,0,0.6)); }
        .nav-icon { font-size: 1.7em; }

        /* TABS */
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeUp 0.3s ease; }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* FOOTER */
        .footer {
            margin-top: 24px;
            padding: 18px 14px;
            text-align: center;
            border-top: 1px solid #2a1a4a;
        }

        .footer-quote {
            font-size: 1.05em;
            color: var(--gold-dark);
            font-style: italic;
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .footer-info { font-size: 0.85em; color: #4a3a6a; }

        /* DIVIDER */
        .divider {
            border: none;
            border-top: 1px solid #2a1a4a;
            margin: 20px 0;
        }

        /* PROGR BAR */
        .prog-label { font-size: 0.85em; color: var(--text-muted); margin-bottom: 4px; display: flex; justify-content: space-between; }
        .prog-bar-bg { background: rgba(255,255,255,0.07); border-radius: 4px; height: 8px; margin-bottom: 10px; overflow: hidden; }
        .prog-bar-fill { height: 100%; border-radius: 4px; background: linear-gradient(90deg, var(--gold-dark), var(--gold-light)); }

        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0d0d1a; }
        ::-webkit-scrollbar-thumb { background: var(--gold-dark); border-radius: 4px; }

        /* â”€â”€ ALLIANCE TAB â”€â”€ */
        .al-scoreboard {
            background: rgba(218,165,32,0.07); border: 2px solid rgba(218,165,32,0.25);
            border-radius: 14px; padding: 18px 16px; margin-bottom: 20px;
        }
        .al-scoreboard-title {
            font-family: 'Cinzel', serif; font-size: 0.82em; color: var(--text-muted);
            letter-spacing: 0.1em; text-transform: uppercase; text-align: center; margin-bottom: 14px;
        }
        .al-score-row { display: flex; align-items: center; gap: 8px; margin-bottom: 16px; }
        .al-score-side { flex: 1; text-align: center; }
        .al-score-pts { font-family: 'Cinzel', serif; font-size: 2.2em; font-weight: 900; line-height: 1; }
        .al-score-label { font-size: 0.88em; font-style: italic; margin-top: 4px; }
        .al-score-winner {
            display: inline-block; margin-top: 6px; font-family: 'Cinzel', serif;
            font-size: 0.72em; padding: 2px 10px; border-radius: 20px; font-weight: 700;
        }
        .al-score-vs {
            font-family: 'Cinzel', serif; font-size: 1.5em; font-weight: 900;
            color: var(--gold); text-shadow: 0 0 10px rgba(255,215,0,0.3); flex-shrink: 0;
        }
        .al-stat-row {
            display: flex; align-items: center; gap: 8px;
            padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.06);
        }
        .al-stat-row:last-child { border-bottom: none; }
        .al-stat-val { flex: 1; text-align: center; font-family: 'Cinzel', serif; font-size: 1.2em; font-weight: 900; }
        .al-stat-label {
            font-family: 'Cinzel', serif; font-size: 0.72em; color: var(--text-muted);
            text-align: center; min-width: 90px; letter-spacing: 0.06em; text-transform: uppercase;
        }
        .al-block { margin-bottom: 24px; }
        .al-header-card {
            display: flex; align-items: center; gap: 12px;
            padding: 14px 16px; border-radius: 12px; margin-bottom: 10px;
        }
        .al-header-card.bastardos {
            background: linear-gradient(135deg, rgba(80,80,100,0.2), rgba(80,80,100,0.05));
            border: 2px solid rgba(176,190,197,0.3);
        }
        .al-header-card.anel {
            background: linear-gradient(135deg, rgba(41,128,185,0.2), rgba(41,128,185,0.05));
            border: 2px solid rgba(41,128,185,0.4);
        }
        .al-header-icon { font-size: 2.4em; flex-shrink: 0; }
        .al-header-info { flex: 1; }
        .al-header-name { font-family: 'Cinzel', serif; font-size: 1.1em; font-weight: 900; letter-spacing: 0.04em; }
        .al-header-name.bastardos { color: #B0BEC5; }
        .al-header-name.anel      { color: #74b9ff; }
        .al-header-sub { font-size: 0.8em; color: var(--text-muted); font-style: italic; margin-top: 2px; }
        .al-header-total { text-align: right; }
        .al-header-pts { font-family: 'Cinzel', serif; font-size: 1.8em; font-weight: 900; }
        .al-header-pts.bastardos { color: #B0BEC5; }
        .al-header-pts.anel      { color: #74b9ff; }
        .al-header-avg { font-size: 0.75em; color: var(--text-muted); font-style: italic; margin-top: 2px; }
        .al-member-row {
            display: flex; align-items: center; gap: 10px;
            padding: 11px 13px; border-radius: 10px; margin-bottom: 7px; border: 1px solid;
        }
        .al-member-row.bastardos { border-color: rgba(176,190,197,0.25); background: rgba(80,80,100,0.05); }
        .al-member-row.anel      { border-color: rgba(41,128,185,0.3);   background: rgba(41,128,185,0.05); }
        .al-member-avatar { font-size: 1.9em; flex-shrink: 0; }
        .al-member-info { flex: 1; }
        .al-member-name { font-family: 'Cinzel', serif; font-size: 0.95em; font-weight: 700; color: var(--gold-light); }
        .al-member-title { font-size: 0.8em; color: var(--gold); font-style: italic; }
        .al-member-pts { text-align: right; }
        .al-member-pts-main { font-family: 'Cinzel', serif; font-size: 1.15em; font-weight: 700; color: var(--gold-light); }
        .al-member-pts-sub { font-size: 0.75em; color: var(--text-muted); }
        .al-vs-divider {
            text-align: center; font-family: 'Cinzel', serif; font-size: 1.2em; font-weight: 900;
            color: var(--gold); margin: 4px 0 18px; letter-spacing: 0.15em;
            text-shadow: 0 0 10px rgba(255,215,0,0.3);
        }
    </style>
</head>
<body>

<div class="header">
    <div class="header-title">âš”ï¸ Guerra dos Reinos âš”ï¸</div>
    <div class="header-sub">Temporada 2026 Â· Rodada <span id="current-round">3</span> de 38</div>
</div>

<div class="content">

    <!-- TAB: RANKING -->
    <div id="tab-ranking" class="tab-content active">
        <div class="section-title">ğŸ† ClassificaÃ§Ã£o Geral</div>
        <div id="ranking-list"></div>
    </div>

    <!-- TAB: ALIANÃ‡AS -->
    <div id="tab-aliancas" class="tab-content">
        <div class="section-title">ğŸ¤ Batalha das AlianÃ§as</div>
        <div id="aliancas-content"></div>
    </div>

    <!-- TAB: MEDIEVAL -->
    <div id="tab-medieval" class="tab-content">
        <div class="section-title">âš”ï¸ Pontos Medievais</div>
        <div id="medieval-list"></div>
    </div>

    <!-- TAB: BATALHAS -->
    <div id="tab-battles" class="tab-content">
        <div class="section-title">ğŸ›¡ï¸ HistÃ³rico de Batalhas</div>
        <div id="battles-list"></div>
    </div>

    <!-- TAB: TÃTULOS -->
    <div id="tab-achievements" class="tab-content">
        <div class="section-title">ğŸ… Hall da Fama</div>
        <div id="achievements-list"></div>
    </div>

    <!-- TAB: REGRAS -->
    <div id="tab-rules" class="tab-content">
        <div class="section-title">ğŸ“œ Regras do Reino</div>
        <div id="rules-content"></div>
    </div>

    <div class="footer">
        <div class="footer-quote">"A glÃ³ria nÃ£o se mede apenas em pontos, mas em conquistas eternas!"</div>
        <div class="footer-info">Sistema de Conquistas Medievais v3.2 Â· Fevereiro 2026</div>
    </div>
</div>

<!-- NAV -->
<div class="bottom-nav">
    <button class="nav-btn active" onclick="switchTab('ranking', this)" aria-label="Ranking">
        <div class="nav-icon">ğŸ†</div><div>Ranking</div>
    </button>
    <button class="nav-btn" onclick="switchTab('aliancas', this)" aria-label="AlianÃ§as">
        <div class="nav-icon">ğŸ¤</div><div>AlianÃ§as</div>
    </button>
    <button class="nav-btn" onclick="switchTab('medieval', this)" aria-label="Medieval">
        <div class="nav-icon">âš”ï¸</div><div>Medieval</div>
    </button>
    <button class="nav-btn" onclick="switchTab('battles', this)" aria-label="Batalhas">
        <div class="nav-icon">ğŸ›¡ï¸</div><div>Batalhas</div>
    </button>
    <button class="nav-btn" onclick="switchTab('achievements', this)" aria-label="TÃ­tulos">
        <div class="nav-icon">ğŸ…</div><div>TÃ­tulos</div>
    </button>
    <button class="nav-btn" onclick="switchTab('rules', this)" aria-label="Regras">
        <div class="nav-icon">ğŸ“œ</div><div>Regras</div>
    </button>
</div>

<script>

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DADOS DOS TIMES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const LORDS = [
    { id: 1,  name: 'Icebergteam',    house: 'Forja Polar',         avatar: 'â„ï¸',  color: '#00CED1', alliance: 'anel'      },
    { id: 2,  name: 'Sons of NÃºmenor',house: 'Herdeiros de Elendil', avatar: 'ğŸ›¡ï¸',  color: '#4169E1', alliance: 'bastardos' },
    { id: 3,  name: 'Ironverdict',    house: 'Forja da JustiÃ§a',    avatar: 'ğŸ—¡ï¸',  color: '#8a8a8a', alliance: 'bastardos' },
    { id: 4,  name: 'CEEC',           house: 'Mestre das Espadas',  avatar: 'âš”ï¸',  color: '#8B0000', alliance: 'anel'      },
    { id: 5,  name: 'OtopatamÃ¡',      house: 'Samurais Guerreiros', avatar: 'ğŸ¤–',  color: '#1E90FF', alliance: 'anel'      },
    { id: 6,  name: 'Andorinha Jr',   house: 'Jovem Veloz',         avatar: 'ğŸ¦',  color: '#FF6347', alliance: 'anel'      },
    { id: 7,  name: 'Andorinha',      house: 'Senhores do Voo',     avatar: 'ğŸ¦…',  color: '#DC143C', alliance: 'anel'      },
    { id: 8,  name: 'Varelitas',      house: 'Guardas da Colina',   avatar: 'ğŸ¦Š',  color: '#228B22', alliance: 'bastardos' },
    { id: 9,  name: 'Lobonegro',      house: 'Agente do Caos',      avatar: 'ğŸº',  color: '#7a5af0', alliance: 'bastardos' },
];

const ALLIANCES = {
    bastardos: { label: 'Os Bastardos',      icon: 'ğŸ—¡ï¸', members: 'Varelitas Â· Lobonegro Â· Sons of NÃºmenor Â· Ironverdict' },
    anel:      { label: 'Sociedade do Anel', icon: 'ğŸ’', members: 'Icebergteam Â· CEEC Â· OtopatamÃ¡ Â· Andorinha Jr Â· Andorinha' },
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DADOS DAS BATALHAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const BATTLE_NAMES = [
    'Cerco do Abismo de Ferro','Massacre da Festa Escarlate','Batalha do PortÃ£o Sombrio',
    'Confronto no Tridente das TrÃªs Garfos','Queda da Torre Cinza',
    'Carnificina nos Campos do Fogo Verde','Cerco da Cidade das Torres Brancas',
    'Batalha das Ãguas Negras em Chamas','Assalto ao Vale das Sombras',
    'Duelo nas Minas da Montanha','Massacre do Casamento Sangrento',
    'Batalha dos Bastardos do Norte','Cerco do Ninho da Lua',
    'Confronto na Forja Flamejante','A Longa Noite dos Mortos',
    'Queda do Rochedo de Ouro','Batalha da BaÃ­a do Rei Escravo',
    'Carnificina no Bosque dos Lobos','Cerco da Muralha Eterna',
    'Massacre nos Degraus de Pedra','Batalha do Forte da Tormenta',
    'DanÃ§a Sangrenta dos DragÃµes','Queda das Torres GÃªmeas do Rio',
    'Cerco do Porto Branco do Norte','Confronto no Jardim das Rosas Mortas',
    'Massacre do Vau Rubi','Batalha da Lagoa dos Deuses',
    'Assalto Ã  Ponta do DragÃ£o','Carnificina no Campo Queimado',
    'Cerco do PortÃ£o Dourado','Batalha do Inverno Eterno',
    'Queda da Coroa de Espinhos','Massacre na Cidadela do Sol',
    'Confronto nas Terras do CrepÃºsculo','Cerco da Fortaleza do Rei da Noite',
    'Batalha dos Sete Reinos Unidos','A Grande Guerra do Amanhecer',
    'RAGNARÃ–K: O FIM DE TODAS AS ERAS',
];

// BATTLES is built dynamically from dados.csv
let BATTLES = [];

function parseCSV(text) {
    const rows = [];
    const lines = text.trim().split('\n');
    for (let i = 1; i < lines.length; i++) {
        const parts = lines[i].trim().split(',');
        if (parts.length < 3) continue;
        const rodada = parseInt(parts[0].trim());
        const name   = parts[1].trim();
        const pontos = parseFloat(parts[2].trim());
        if (!isNaN(rodada) && name && !isNaN(pontos)) rows.push({ rodada, name, pontos });
    }
    return rows;
}

function buildBattles(rows) {
    const map = {};
    rows.forEach(r => {
        if (!map[r.rodada]) map[r.rodada] = [];
        // Match CSV name to LORDS by name
        const lord = LORDS.find(l => l.name.toLowerCase().trim() === r.name.toLowerCase().trim());
        if (lord) map[r.rodada].push({ lordId: lord.id, points: r.pontos });
    });
    return Object.keys(map).map(Number).sort((a,b)=>a-b).map(week => ({
        week,
        name: BATTLE_NAMES[week-1] || `Batalha ${week}`,
        results: map[week],
    }));
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TÃTULOS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const TITLES = {
    mvp: [
        { min: 15, title: 'âš¡ Portador de Glamdring' },
        { min: 10, title: 'ğŸ‰ O Rei que Voltou' },
        { min: 7,  title: 'âšœï¸ Rei Coroado de Gondor' },
        { min: 5,  title: 'ğŸ‘‘ Herdeiro de Isildur' },
        { min: 3,  title: 'ğŸ›¡ï¸ Senhor dos Cavaleiros de Rohan' },
        { min: 1,  title: 'âš”ï¸ Cavaleiro da Companhia' },
    ],
    mitada: [
        { min: 10, title: 'âš¡ Portador da Espada de Fogo' },
        { min: 7,  title: 'ğŸ’ Portador da Garra Longa' },
        { min: 5,  title: 'ğŸŒŸ Cavaleiro do Amanhecer' },
        { min: 3,  title: 'âš”ï¸ Empunhador de Anduril' },
        { min: 1,  title: 'ğŸ”¥ Portador da Ferroada' },
    ],
    recuperacao: [
        { min: 7, title: 'ğŸŒŸ Ressurgido das Trevas' },
        { min: 5, title: 'âš¡ Jon Snow Ressuscitado' },
        { min: 3, title: 'ğŸ‰ Renascido no Fogo' },
        { min: 1, title: 'ğŸ¦… Cavaleiro do Corvo Branco' },
    ],
    massacre: [
        { min: 7, title: 'ğŸ‰ Terror de Westeros' },
        { min: 5, title: 'ğŸ”± Flagelo dos Reinos' },
        { min: 3, title: 'âš”ï¸ O Senhor do AÃ§o Negro' },
        { min: 1, title: 'ğŸ—¡ï¸ Conquistador de Terras' },
    ],
    podio: [
        { min: 15, title: 'ğŸ’« Protetor dos Sete Reinos' },
        { min: 10, title: 'ğŸ–ï¸ MÃ£o do Rei' },
        { min: 8,  title: 'ğŸ’ Lorde Comandante da Muralha' },
        { min: 5,  title: 'ğŸ… Cavaleiro da Guarda Real' },
        { min: 1,  title: 'ğŸ¯ GuardiÃ£o da Torre Branca' },
    ],
    lanterna: [
        { min: 10, title: 'ğŸ•³ï¸ Rei da Noite Eterna' },
        { min: 7,  title: 'ğŸŒ‘ Prisioneiro de Mordor' },
        { min: 5,  title: 'ğŸ’€ Servo de Sauron' },
        { min: 3,  title: 'âš°ï¸ Habitante das Terras Sombrias' },
        { min: 1,  title: 'ğŸ—¡ï¸ Banido para o ExÃ­lio' },
    ],
};

function getTitle(type, count) {
    if (!count) return '';
    for (const t of TITLES[type] || []) {
        if (count >= t.min) return t.title;
    }
    return '';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CÃLCULO DE PONTOS MEDIEVAIS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function calcMedievalPoints(ach) {
    let pts = 0;
    const { mvp=0, podio=0, mitada=0, recuperacao=0, massacre=0, lanterna=0 } = ach;

    // MVP progressivo
    if      (mvp >= 15) pts += 200;
    else if (mvp >= 10) pts += 135;
    else if (mvp >= 7)  pts += 95;
    else if (mvp >= 5)  pts += 65;
    else if (mvp >= 3)  pts += 40;
    else                pts += mvp * 10;

    // PÃ³dio progressivo
    if      (podio >= 15) pts += 75;
    else if (podio >= 10) pts += 45;
    else if (podio >= 8)  pts += 34;
    else if (podio >= 5)  pts += 20;
    else                  pts += podio * 3;

    // Mitada progressivo (80, 90, 100, 110 somam no mesmo contador)
    if      (mitada >= 10) pts += 100;
    else if (mitada >= 7)  pts += 70;
    else if (mitada >= 5)  pts += 45;
    else if (mitada >= 3)  pts += 23;
    else                   pts += mitada * 5;

    // RecuperaÃ§Ã£o progressivo
    if      (recuperacao >= 7) pts += 96;
    else if (recuperacao >= 5) pts += 65;
    else if (recuperacao >= 3) pts += 36;
    else                       pts += recuperacao * 8;

    // Massacre progressivo
    if      (massacre >= 7) pts += 62;
    else if (massacre >= 5) pts += 40;
    else if (massacre >= 3) pts += 22;
    else                    pts += massacre * 6;

    // Lanterna penalidade progressiva
    if      (lanterna >= 10) pts -= 100;
    else if (lanterna >= 7)  pts -= 70;
    else if (lanterna >= 5)  pts -= 45;
    else if (lanterna >= 3)  pts -= 23;
    else                     pts -= lanterna * 5;

    return pts;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PROCESSAR CONQUISTAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function processAll() {
    const acumulado = {};
    LORDS.forEach(l => acumulado[l.id] = 0);

    const lordsData = LORDS.map(lord => ({
        ...lord,
        cartolaPoints: 0,
        mvp: 0, podio: 0, mitada: 0,
        recuperacao: 0, massacre: 0, lanterna: 0,
        medievalPoints: 0, totalPoints: 0,
        currentTitle: 'ğŸ“° Escudeiro Sem Nome',
        // bÃ´nus G2 por rodada (nÃ£o progressivo)
        bonusG2: 0,
    }));

    let prevPoints = {};

    BATTLES.forEach((battle, idx) => {
        const sorted = [...battle.results].sort((a,b) => b.points - a.points);
        const acumAntes = {...acumulado};

        // Atualizar acumulado
        battle.results.forEach(r => { acumulado[r.lordId] += r.points; });
        const acumDepois = {...acumulado};

        // Ranking antes e depois
        const rankAntes  = Object.entries(acumAntes).sort((a,b)  => b[1]-a[1]).map(e=>+e[0]);
        const rankDepois = Object.entries(acumDepois).sort((a,b) => b[1]-a[1]).map(e=>+e[0]);
        const posAntes   = {};
        const posDepois  = {};
        rankAntes.forEach((id,i)  => posAntes[id]  = i);
        rankDepois.forEach((id,i) => posDepois[id] = i);

        sorted.forEach((result, position) => {
            const ld = lordsData.find(l => l.id === result.lordId);
            ld.cartolaPoints += result.points;

            // MVP
            if (position === 0 && result.points > 0) ld.mvp++;

            // PÃ³dio (2Âº ou 3Âº, MVP nÃ£o acumula)
            if (position === 1 || position === 2) ld.podio++;

            // Mitada G1 (â‰¥80 pts, base do contador)
            if (result.points >= 80) ld.mitada++;

            // BÃ´nus G2 por rodada
            if (result.points >= 110)      ld.bonusG2 += 14;
            else if (result.points >= 100) ld.bonusG2 += 8;
            else if (result.points >= 90)  ld.bonusG2 += 4;

            // Lanterna
            if (position === sorted.length - 1 && result.points > 0) ld.lanterna++;

            // RecuperaÃ§Ã£o
            if (idx > 0 && prevPoints[result.lordId] > 0) {
                const diff = result.points - prevPoints[result.lordId];
                if (diff >= 50) ld.recuperacao++;
            }

            // Massacre
            if (idx > 0) {
                const myId = result.lordId;
                const subiu = posAntes[myId] - posDepois[myId] > 0;
                if (subiu) {
                    let temMassacre = false;
                    LORDS.forEach(outro => {
                        if (outro.id === myId) return;
                        const ultrapassou = posAntes[myId] > posAntes[outro.id] && posDepois[myId] < posDepois[outro.id];
                        if (ultrapassou) {
                            const diff = acumDepois[myId] - acumDepois[outro.id];
                            if (diff >= 10) temMassacre = true;
                        }
                    });
                    if (temMassacre) ld.massacre++;
                }
            }
        });

        // Salvar pontos desta rodada para prÃ³xima
        battle.results.forEach(r => { prevPoints[r.lordId] = r.points; });
    });

    // Calcular pontos medievais e tÃ­tulos
    lordsData.forEach(ld => {
        const ach = { mvp: ld.mvp, podio: ld.podio, mitada: ld.mitada, recuperacao: ld.recuperacao, massacre: ld.massacre, lanterna: ld.lanterna };
        ld.medievalPoints = calcMedievalPoints(ach) + ld.bonusG2;
        ld.totalPoints = ld.cartolaPoints + ld.medievalPoints;

        // TÃ­tulo principal (ordem de prioridade)
        ld.currentTitle =
            getTitle('mvp', ld.mvp) ||
            getTitle('mitada', ld.mitada) ||
            getTitle('recuperacao', ld.recuperacao) ||
            getTitle('massacre', ld.massacre) ||
            getTitle('podio', ld.podio) ||
            getTitle('lanterna', ld.lanterna) ||
            'ğŸ“° Escudeiro Sem Nome';
    });

    return lordsData.sort((a,b) => b.totalPoints - a.totalPoints);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER RANKING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderRanking() {
    const data = processAll();
    const el = document.getElementById('ranking-list');

    el.innerHTML = data.map((lord, i) => {
        const posClass = i===0?'pos-1':i===1?'pos-2':i===2?'pos-3':'pos-n';
        const medClass = lord.medievalPoints >= 0 ? 'pts-medieval-pos' : 'pts-medieval-neg';
        const medSign  = lord.medievalPoints >= 0 ? '+' : '';

        return `
        <div class="lord-card expandable" style="border-color:${lord.color}" onclick="toggleDetails(${lord.id})">
            ${i===0 ? '<div class="crown-icon">ğŸ‘‘</div>' : ''}
            <div class="lord-header">
                <div class="position-badge ${posClass}">${i+1}</div>
                <div class="avatar">${lord.avatar}</div>
                <div class="lord-info">
                    <div class="lord-name">${lord.name}</div>
                    <div class="lord-house" style="color:${lord.color}">${lord.house}</div>
                    <div class="lord-title">${lord.currentTitle}</div>
                </div>
            </div>
            <div class="points-display">
                <div class="total-points">${lord.totalPoints.toFixed(2)}</div>
                <div class="points-breakdown">
                    <span class="pts-cartola">ğŸ“Š ${lord.cartolaPoints.toFixed(2)}</span>
                    <span class="${medClass}">âš”ï¸ ${medSign}${lord.medievalPoints}</span>
                </div>
            </div>
            <div class="lord-details" id="details-${lord.id}">
                <div class="stats-grid">
                    <div class="stat-item"><div class="stat-label">ğŸ† MVP</div><div class="stat-value">${lord.mvp}x</div></div>
                    <div class="stat-item"><div class="stat-label">ğŸ’€ Mitada</div><div class="stat-value">${lord.mitada}x</div></div>
                    <div class="stat-item"><div class="stat-label">ğŸ¥‡ PÃ³dio</div><div class="stat-value">${lord.podio}x</div></div>
                    <div class="stat-item"><div class="stat-label">ğŸ“ˆ Recup.</div><div class="stat-value">${lord.recuperacao}x</div></div>
                    <div class="stat-item"><div class="stat-label">ğŸ—¡ï¸ Massacre</div><div class="stat-value">${lord.massacre}x</div></div>
                    <div class="stat-item"><div class="stat-label">ğŸ”¦ Lanterna</div><div class="stat-value negative">${lord.lanterna}x</div></div>
                </div>
            </div>
            <div class="expand-btn" id="indicator-${lord.id}">â–¼ Toque para ver detalhes</div>
        </div>`;
    }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER MEDIEVAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderMedieval() {
    const data = processAll();
    const sorted = [...data].sort((a,b) => b.medievalPoints - a.medievalPoints);
    const el = document.getElementById('medieval-list');

    el.innerHTML = sorted.map(lord => {
        const medColor = lord.medievalPoints >= 0 ? '#4CAF50' : '#e74c3c';
        const medSign  = lord.medievalPoints >= 0 ? '+' : '';

        return `
        <div class="lord-card" style="border-color:${lord.color}">
            <div class="lord-header">
                <div class="avatar">${lord.avatar}</div>
                <div class="lord-info">
                    <div class="lord-name">${lord.name}</div>
                    <div class="lord-house" style="color:${lord.color}">${lord.house}</div>
                    <div class="lord-title">${lord.currentTitle}</div>
                </div>
            </div>
            <div class="points-display">
                <div class="total-points" style="color:${medColor}">${medSign}${lord.medievalPoints}</div>
                <div style="font-size:0.95em;color:var(--gold);font-style:italic;">Pontos Medievais</div>
            </div>
            <div class="stats-grid">
                <div class="stat-item"><div class="stat-label">ğŸ† MVP</div><div class="stat-value">${lord.mvp}x</div></div>
                <div class="stat-item"><div class="stat-label">ğŸ’€ Mitada</div><div class="stat-value">${lord.mitada}x</div></div>
                <div class="stat-item"><div class="stat-label">ğŸ¥‡ PÃ³dio</div><div class="stat-value">${lord.podio}x</div></div>
                <div class="stat-item"><div class="stat-label">ğŸ“ˆ Recup.</div><div class="stat-value">${lord.recuperacao}x</div></div>
                <div class="stat-item"><div class="stat-label">ğŸ—¡ï¸ Massacre</div><div class="stat-value">${lord.massacre}x</div></div>
                <div class="stat-item"><div class="stat-label">ğŸ”¦ Lanterna</div><div class="stat-value negative">${lord.lanterna}x</div></div>
            </div>
        </div>`;
    }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER BATALHAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderBattles() {
    const data = processAll();
    const el = document.getElementById('battles-list');

    el.innerHTML = BATTLES.map(battle => {
        const sorted = [...battle.results].sort((a,b) => b.points - a.points);
        const winner = data.find(l => l.id === sorted[0].lordId);

        return `
        <div class="battle-card" onclick="toggleBattle(${battle.week})">
            <div class="battle-round">Rodada ${battle.week}</div>
            <div class="battle-name">${battle.name}</div>
            <div class="battle-winner">ğŸ† ${winner.name}</div>
            <div class="expand-btn" id="battle-ind-${battle.week}">â–¼ Ver resultados</div>
            <div class="battle-results" id="battle-res-${battle.week}">
                ${sorted.map((r, idx) => {
                    const lord = data.find(l => l.id === r.lordId);
                    const badges = [];
                    if (idx === 0 && r.points > 0) badges.push('ğŸ†');
                    if (r.points >= 110) badges.push('ğŸ”¥+110');
                    else if (r.points >= 100) badges.push('ğŸ’¥+100');
                    else if (r.points >= 90)  badges.push('âš¡+90');
                    else if (r.points >= 80)  badges.push('ğŸ’€+80');
                    if (idx < 3) badges.push('ğŸ¥‡');
                    if (idx === sorted.length - 1 && r.points > 0) badges.push('ğŸ”¦');

                    return `
                    <div class="result-row" style="border-color:${lord.color};background:${idx===0?'rgba(218,165,32,0.1)':'rgba(255,255,255,0.03)'}">
                        <div class="result-left">
                            <div class="result-avatar">${lord.avatar}</div>
                            <div>
                                <div class="result-name">${lord.name}</div>
                                ${badges.length ? `<div class="result-badges">${badges.join(' ')}</div>` : ''}
                            </div>
                        </div>
                        <div class="result-pts">${r.points.toFixed(2)}</div>
                    </div>`;
                }).join('')}
            </div>
        </div>`;
    }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER ACHIEVEMENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderAchievements() {
    const data = processAll();
    const el = document.getElementById('achievements-list');

    const mvpKing   = [...data].sort((a,b) => b.mvp-a.mvp)[0];
    const mitKing   = [...data].sort((a,b) => b.mitada-a.mitada)[0];
    const recKing   = [...data].sort((a,b) => b.recuperacao-a.recuperacao)[0];
    const masKing   = [...data].sort((a,b) => b.massacre-a.massacre)[0];

    let html = '<div style="margin-bottom:20px;text-align:center;font-family:Cinzel,serif;color:var(--gold);font-size:1.05em;letter-spacing:0.05em;">â­ DESTAQUES DA TEMPORADA â­</div>';

    if (mvpKing?.mvp > 0) html += `
        <div class="hall-card" style="background:linear-gradient(135deg,#4a3500,#7a5500);border:2px solid #DAA520;">
            <div class="hall-avatar">${mvpKing.avatar}</div>
            <div class="hall-category" style="color:#FFD700;">ğŸ† REI DAS VITÃ“RIAS</div>
            <div class="hall-name" style="color:#FFD700;">${mvpKing.name}</div>
            <div class="hall-achievement">${mvpKing.mvp}x MVP</div>
            <div class="hall-title" style="color:#d4b896;">${getTitle('mvp',mvpKing.mvp)}</div>
        </div>`;

    if (mitKing?.mitada > 0) html += `
        <div class="hall-card" style="background:linear-gradient(135deg,#3a0000,#6a0000);border:2px solid #e74c3c;">
            <div class="hall-avatar">${mitKing.avatar}</div>
            <div class="hall-category" style="color:#ff6b6b;">ğŸ’€ MESTRE DA DESTRUIÃ‡ÃƒO</div>
            <div class="hall-name" style="color:#fff;">${mitKing.name}</div>
            <div class="hall-achievement">${mitKing.mitada}x Mitada (80+ pts)</div>
            <div class="hall-title" style="color:#ffaaaa;">${getTitle('mitada',mitKing.mitada)}</div>
        </div>`;

    if (recKing?.recuperacao > 0) html += `
        <div class="hall-card" style="background:linear-gradient(135deg,#002040,#003060);border:2px solid #3498db;">
            <div class="hall-avatar">${recKing.avatar}</div>
            <div class="hall-category" style="color:#74b9ff;">ğŸ“ˆ A FÃŠNIX IMORTAL</div>
            <div class="hall-name" style="color:#fff;">${recKing.name}</div>
            <div class="hall-achievement">${recKing.recuperacao}x RecuperaÃ§Ã£o</div>
            <div class="hall-title" style="color:#a8d8ff;">${getTitle('recuperacao',recKing.recuperacao)}</div>
        </div>`;

    if (masKing?.massacre > 0) html += `
        <div class="hall-card" style="background:linear-gradient(135deg,#1a0a2a,#2a1040);border:2px solid #9b59b6;">
            <div class="hall-avatar">${masKing.avatar}</div>
            <div class="hall-category" style="color:#c39bd3;">ğŸ—¡ï¸ SENHOR DO MASSACRE</div>
            <div class="hall-name" style="color:#fff;">${masKing.name}</div>
            <div class="hall-achievement">${masKing.massacre}x Massacre</div>
            <div class="hall-title" style="color:#d7bde2;">${getTitle('massacre',masKing.massacre)}</div>
        </div>`;

    html += '<hr class="divider"><div style="font-family:Cinzel,serif;color:var(--gold);font-size:1em;margin-bottom:16px;letter-spacing:0.05em;">ğŸ“œ TODOS OS TÃTULOS</div>';

    html += data.map(lord => `
        <div class="lord-card" style="border-color:${lord.color}">
            <div class="lord-header">
                <div class="avatar">${lord.avatar}</div>
                <div class="lord-info">
                    <div class="lord-name">${lord.name}</div>
                    <div class="lord-title">${lord.currentTitle}</div>
                </div>
            </div>
            <div class="stats-grid">
                ${lord.mvp>0?`<div class="stat-item" style="background:rgba(255,215,0,0.08)"><div class="stat-label">ğŸ† MVP</div><div class="stat-value">${lord.mvp}x</div><div style="font-size:0.78em;color:var(--gold);margin-top:3px">${getTitle('mvp',lord.mvp)}</div></div>`:''}
                ${lord.mitada>0?`<div class="stat-item" style="background:rgba(231,76,60,0.08)"><div class="stat-label">ğŸ’€ Mitada</div><div class="stat-value">${lord.mitada}x</div><div style="font-size:0.78em;color:#e74c3c;margin-top:3px">${getTitle('mitada',lord.mitada)}</div></div>`:''}
                ${lord.recuperacao>0?`<div class="stat-item" style="background:rgba(52,152,219,0.08)"><div class="stat-label">ğŸ“ˆ Recup.</div><div class="stat-value">${lord.recuperacao}x</div><div style="font-size:0.78em;color:#3498db;margin-top:3px">${getTitle('recuperacao',lord.recuperacao)}</div></div>`:''}
                ${lord.massacre>0?`<div class="stat-item" style="background:rgba(155,89,182,0.08)"><div class="stat-label">ğŸ—¡ï¸ Massacre</div><div class="stat-value">${lord.massacre}x</div><div style="font-size:0.78em;color:#9b59b6;margin-top:3px">${getTitle('massacre',lord.massacre)}</div></div>`:''}
                ${lord.podio>0?`<div class="stat-item"><div class="stat-label">ğŸ¥‡ PÃ³dio</div><div class="stat-value">${lord.podio}x</div></div>`:''}
                ${lord.lanterna>0?`<div class="stat-item"><div class="stat-label">ğŸ”¦ Lanterna</div><div class="stat-value negative">${lord.lanterna}x</div></div>`:''}
            </div>
        </div>`).join('');

    el.innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER REGRAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderRules() {
    const el = document.getElementById('rules-content');
    el.innerHTML = `
    <div class="rules-section">
        <div class="rules-group-title">âš”ï¸ GRUPO 1 â€” Conquistas por Rodada</div>
        <table class="rules-table">
            <tr><th>Conquista</th><th>CritÃ©rio</th><th>Pts</th></tr>
            <tr><td>ğŸ† MVP</td><td>1Âº lugar na rodada</td><td class="pts-pos">+10</td></tr>
            <tr><td>ğŸ¥‡ PÃ³dio</td><td>2Âº ou 3Âº lugar <em>(MVP nÃ£o acumula)</em></td><td class="pts-pos">+3</td></tr>
            <tr><td>ğŸ’€ Mitada</td><td>â‰¥ 80 pts na rodada</td><td class="pts-pos">+5</td></tr>
            <tr><td>ğŸ“ˆ RecuperaÃ§Ã£o</td><td>+50 pts vs rodada anterior</td><td class="pts-pos">+8</td></tr>
            <tr><td>ğŸ—¡ï¸ Massacre</td><td>Ultrapassa c/ 10+ pts no acumulado</td><td class="pts-pos">+6</td></tr>
            <tr><td>ğŸ”¦ Lanterna</td><td>Ãšltimo lugar na rodada</td><td class="pts-neg">âˆ’5</td></tr>
        </table>
        <div class="rule-note">MVP e PÃ³dio sÃ£o excludentes. Quem vence a rodada recebe apenas os +10 do MVP.</div>
    </div>

    <div class="rules-section">
        <div class="rules-group-title">âš¡ GRUPO 2 â€” Escada de Mitada <em style="font-weight:400;font-size:0.9em">(bÃ´nus extra sobre os +5 da Mitada)</em></div>
        <table class="rules-table">
            <tr><th>Conquista</th><th>CritÃ©rio</th><th>BÃ´nus G2</th><th>Total</th></tr>
            <tr><td>âš¡ Mitada 90</td><td>â‰¥ 90 e &lt; 100 pts</td><td class="pts-bonus">+4</td><td class="pts-bonus">+9</td></tr>
            <tr><td>ğŸ’¥ Mitada 100</td><td>â‰¥ 100 e &lt; 110 pts</td><td class="pts-bonus">+8</td><td class="pts-bonus">+13</td></tr>
            <tr><td>ğŸ”¥ Mitada 110</td><td>â‰¥ 110 pts</td><td class="pts-bonus">+14</td><td class="pts-bonus">+19</td></tr>
        </table>
        <div class="rule-note">A Escada sempre acumula com a Mitada do G1. Quem faz 95 pts recebe +5 (Mitada) + +4 (Mitada 90) = +9 total. Apenas um nÃ­vel da escada por rodada.</div>
    </div>

    <div class="rules-section">
        <div class="rules-group-title">ğŸ† PrÃªmios Finais â€” Rodada 38</div>
        <table class="rules-table">
            <tr><th>PosiÃ§Ã£o</th><th>TÃ­tulo</th><th>BÃ´nus</th></tr>
            <tr><td>ğŸ¥‡ 1Âº Lugar</td><td>ğŸ‰ Imperador dos Sete Reinos</td><td class="pts-pos">+50</td></tr>
            <tr><td>ğŸ¥ˆ 2Âº Lugar</td><td>ğŸ‘‘ PrÃ­ncipe de Pedra do DragÃ£o</td><td class="pts-pos">+30</td></tr>
            <tr><td>ğŸ¥‰ 3Âº Lugar</td><td>âš”ï¸ Senhor de Winterfell</td><td class="pts-pos">+20</td></tr>
            <tr><td>ğŸ’€ Ãšltimo</td><td>ğŸ•³ï¸ O Esquecido pelas CrÃ´nicas</td><td class="pts-neg">âˆ’30</td></tr>
        </table>
        <table class="rules-table">
            <tr><th>PrÃªmio Especial</th><th>CondiÃ§Ã£o</th><th>BÃ´nus</th></tr>
            <tr><td>ğŸ‘‘ CampeÃ£o Invicto</td><td>1Âº sem nunca ser Lanterna</td><td class="pts-pos">+50</td></tr>
            <tr><td>ğŸ‰ A Virada dos DragÃµes</td><td>CampeÃ£o vindo do 6Âº ou abaixo</td><td class="pts-pos">+40</td></tr>
            <tr><td>ğŸ† Rei das VitÃ³rias</td><td>Mais MVPs na temporada</td><td class="pts-pos">+35</td></tr>
            <tr><td>ğŸ¯ PerfeiÃ§Ã£o Encarnada</td><td>Maior mÃ©dia Cartola</td><td class="pts-pos">+30</td></tr>
        </table>
    </div>

    <div class="rules-section">
        <div class="rules-group-title">ğŸ“ˆ BÃ´nus Progressivos por Conquista</div>
        <div class="rule-note">Quanto mais conquistas acumuladas na temporada, maior o bÃ´nus total. Ao atingir um novo marco, o valor sobe para o patamar correspondente.</div>

        <div style="margin-bottom:14px">
            <div style="font-family:Cinzel,serif;font-size:0.95em;color:var(--gold);margin-bottom:8px;letter-spacing:0.03em;">ğŸ† MVP â€” teto 200 pts</div>
            <table class="rules-table">
                <tr><th>Acumulado</th><th>Pts Totais</th><th>TÃ­tulo</th></tr>
                <tr><td>1x</td><td class="pts-pos">10</td><td>âš”ï¸ Cavaleiro da Companhia</td></tr>
                <tr><td>3x</td><td class="pts-pos">40</td><td>ğŸ›¡ï¸ Senhor dos Cavaleiros de Rohan</td></tr>
                <tr><td>5x</td><td class="pts-pos">65</td><td>ğŸ‘‘ Herdeiro de Isildur</td></tr>
                <tr><td>7x</td><td class="pts-pos">95</td><td>âšœï¸ Rei Coroado de Gondor</td></tr>
                <tr><td>10x</td><td class="pts-pos">135</td><td>ğŸ‰ O Rei que Voltou</td></tr>
                <tr><td>15x</td><td class="pts-pos">200</td><td>âš¡ Portador de Glamdring</td></tr>
            </table>
        </div>

        <div style="margin-bottom:14px">
            <div style="font-family:Cinzel,serif;font-size:0.95em;color:var(--gold);margin-bottom:8px;letter-spacing:0.03em;">ğŸ¥‡ PÃ³dio â€” teto 75 pts</div>
            <table class="rules-table">
                <tr><th>Acumulado</th><th>Pts Totais</th><th>TÃ­tulo</th></tr>
                <tr><td>1x</td><td class="pts-pos">3</td><td>ğŸ¯ GuardiÃ£o da Torre Branca</td></tr>
                <tr><td>5x</td><td class="pts-pos">20</td><td>ğŸ… Cavaleiro da Guarda Real</td></tr>
                <tr><td>8x</td><td class="pts-pos">34</td><td>ğŸ’ Lorde Comandante da Muralha</td></tr>
                <tr><td>10x</td><td class="pts-pos">45</td><td>ğŸ–ï¸ MÃ£o do Rei</td></tr>
                <tr><td>15x</td><td class="pts-pos">75</td><td>ğŸ’« Protetor dos Sete Reinos</td></tr>
            </table>
        </div>

        <div style="margin-bottom:14px">
            <div style="font-family:Cinzel,serif;font-size:0.95em;color:var(--gold);margin-bottom:8px;letter-spacing:0.03em;">ğŸ’€ Mitada â€” teto 100 pts <em style="font-weight:400;font-size:0.9em">(G1 + G2 somam no mesmo contador)</em></div>
            <table class="rules-table">
                <tr><th>Acumulado</th><th>Pts Totais</th><th>TÃ­tulo</th></tr>
                <tr><td>1x</td><td class="pts-pos">5</td><td>ğŸ”¥ Portador da Ferroada</td></tr>
                <tr><td>3x</td><td class="pts-pos">23</td><td>âš”ï¸ Empunhador de AndÃºril</td></tr>
                <tr><td>5x</td><td class="pts-pos">45</td><td>ğŸŒŸ Cavaleiro do Amanhecer</td></tr>
                <tr><td>7x</td><td class="pts-pos">70</td><td>ğŸ’ Portador da Garra Longa</td></tr>
                <tr><td>10x</td><td class="pts-pos">100</td><td>âš¡ Portador da Espada de Fogo</td></tr>
            </table>
        </div>

        <div style="margin-bottom:14px">
            <div style="font-family:Cinzel,serif;font-size:0.95em;color:var(--gold);margin-bottom:8px;letter-spacing:0.03em;">ğŸ“ˆ RecuperaÃ§Ã£o â€” teto 96 pts</div>
            <table class="rules-table">
                <tr><th>Acumulado</th><th>Pts Totais</th><th>TÃ­tulo</th></tr>
                <tr><td>1x</td><td class="pts-pos">8</td><td>ğŸ¦… Cavaleiro do Corvo Branco</td></tr>
                <tr><td>3x</td><td class="pts-pos">36</td><td>ğŸ‰ Renascido no Fogo</td></tr>
                <tr><td>5x</td><td class="pts-pos">65</td><td>âš¡ Jon Snow Ressuscitado</td></tr>
                <tr><td>7x</td><td class="pts-pos">96</td><td>ğŸŒŸ Ressurgido das Trevas</td></tr>
            </table>
        </div>

        <div style="margin-bottom:14px">
            <div style="font-family:Cinzel,serif;font-size:0.95em;color:var(--gold);margin-bottom:8px;letter-spacing:0.03em;">ğŸ—¡ï¸ Massacre â€” teto 62 pts</div>
            <table class="rules-table">
                <tr><th>Acumulado</th><th>Pts Totais</th><th>TÃ­tulo</th></tr>
                <tr><td>1x</td><td class="pts-pos">6</td><td>ğŸ—¡ï¸ Conquistador de Terras</td></tr>
                <tr><td>3x</td><td class="pts-pos">22</td><td>âš”ï¸ O Senhor do AÃ§o Negro</td></tr>
                <tr><td>5x</td><td class="pts-pos">40</td><td>ğŸ”± Flagelo dos Reinos</td></tr>
                <tr><td>7x</td><td class="pts-pos">62</td><td>ğŸ‰ Terror de Westeros</td></tr>
            </table>
        </div>

        <div style="margin-bottom:14px">
            <div style="font-family:Cinzel,serif;font-size:0.95em;color:#e74c3c;margin-bottom:8px;letter-spacing:0.03em;">ğŸ”¦ Lanterna â€” penalidade mÃ¡xima âˆ’100 pts</div>
            <table class="rules-table">
                <tr><th>Acumulado</th><th>Penalidade</th><th>TÃ­tulo</th></tr>
                <tr><td>1x</td><td class="pts-neg">âˆ’5</td><td>ğŸ—¡ï¸ Banido para o ExÃ­lio</td></tr>
                <tr><td>3x</td><td class="pts-neg">âˆ’23</td><td>âš°ï¸ Habitante das Terras Sombrias</td></tr>
                <tr><td>5x</td><td class="pts-neg">âˆ’45</td><td>ğŸ’€ Servo de Sauron</td></tr>
                <tr><td>7x</td><td class="pts-neg">âˆ’70</td><td>ğŸŒ‘ Prisioneiro de Mordor</td></tr>
                <tr><td>10x</td><td class="pts-neg">âˆ’100</td><td>ğŸ•³ï¸ Rei da Noite Eterna</td></tr>
            </table>
        </div>
    </div>

    <div class="rules-section">
        <div class="rules-group-title">ğŸ° Os Nove Reinos</div>
        <table class="rules-table">
            <tr><th>Reino</th><th>Casa</th><th></th></tr>
            ${LORDS.map(l=>`<tr><td style="color:${l.color};font-weight:700">${l.name}</td><td>${l.house}</td><td style="font-size:1.4em">${l.avatar}</td></tr>`).join('')}
        </table>
    </div>
    `;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOGGLE / NAVEGAÃ‡ÃƒO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleDetails(id) {
    const d = document.getElementById(`details-${id}`);
    const i = document.getElementById(`indicator-${id}`);
    const show = d.classList.toggle('show');
    i.textContent = show ? 'â–² Toque para recolher' : 'â–¼ Toque para ver detalhes';
}

function toggleBattle(week) {
    const r = document.getElementById(`battle-res-${week}`);
    const i = document.getElementById(`battle-ind-${week}`);
    const show = r.classList.toggle('show');
    i.textContent = show ? 'â–² Recolher' : 'â–¼ Ver resultados';
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER ALIANÃ‡AS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderAliancas() {
    const data = processAll();

    const bastardos = data.filter(l => l.alliance === 'bastardos');
    const anel      = data.filter(l => l.alliance === 'anel');
    const sumT = arr => arr.reduce((s,l) => s + l.totalPoints, 0);
    const avgT = arr => sumT(arr) / arr.length;
    const bPts = sumT(bastardos), aPts = sumT(anel);
    const bAvg = avgT(bastardos), aAvg = avgT(anel);
    const bWin = bPts > aPts, tie = bPts === aPts;

    const bColor = '#B0BEC5', aColor = '#74b9ff';

    const statRow = (label, bVal, aVal, fmt) => {
        const bWins = bVal > aVal, tied = bVal === aVal;
        return `
        <div class="al-stat-row">
            <div class="al-stat-val" style="color:${bColor}">
                ${fmt(bVal)}${!tied && bWins ? ' <span style="font-size:0.65em">â–²</span>' : ''}
            </div>
            <div class="al-stat-label">${label}</div>
            <div class="al-stat-val" style="color:${aColor}">
                ${fmt(aVal)}${!tied && !bWins ? ' <span style="font-size:0.65em">â–²</span>' : ''}
            </div>
        </div>`;
    };

    const memberRow = (lord, alKey) => `
    <div class="al-member-row ${alKey}">
        <div class="al-member-avatar">${lord.avatar}</div>
        <div class="al-member-info">
            <div class="al-member-name">${lord.name}</div>
            <div class="al-member-title">${lord.currentTitle || 'ğŸ“° Escudeiro Sem Nome'}</div>
        </div>
        <div class="al-member-pts">
            <div class="al-member-pts-main">${lord.totalPoints.toFixed(0)}</div>
            <div class="al-member-pts-sub">ğŸ“Š ${lord.cartolaPoints.toFixed(2)}</div>
        </div>
    </div>`;

    const html = `
    <div class="al-scoreboard">
        <div class="al-scoreboard-title">Placar Geral das AlianÃ§as</div>
        <div class="al-score-row">
            <div class="al-score-side">
                <div class="al-score-pts" style="color:${bColor}">${bPts.toFixed(0)}</div>
                <div class="al-score-label" style="color:${bColor}">ğŸ—¡ï¸ Os Bastardos</div>
                ${!tie && bWin ? `<div class="al-score-winner" style="background:rgba(80,80,100,0.2);border:1px solid #B0BEC5;color:#B0BEC5;">ğŸ‘‘ Liderando</div>` : ''}
            </div>
            <div class="al-score-vs">VS</div>
            <div class="al-score-side">
                <div class="al-score-pts" style="color:${aColor}">${aPts.toFixed(0)}</div>
                <div class="al-score-label" style="color:${aColor}">ğŸ’ Soc. do Anel</div>
                ${!tie && !bWin ? `<div class="al-score-winner" style="background:rgba(41,128,185,0.2);border:1px solid #2980b9;color:#74b9ff;">ğŸ‘‘ Liderando</div>` : ''}
            </div>
        </div>
        ${statRow('Total', bPts, aPts, v => v.toFixed(0))}
        ${statRow('MÃ©dia / membro', bAvg, aAvg, v => v.toFixed(1))}
        ${tie ? '<div style="margin-top:10px;text-align:center;font-family:Cinzel,serif;color:var(--gold);font-size:0.9em;">âš–ï¸ Empate!</div>' : ''}
    </div>

    <div class="al-block">
        <div class="al-header-card bastardos">
            <div class="al-header-icon">ğŸ—¡ï¸</div>
            <div class="al-header-info">
                <div class="al-header-name bastardos">Os Bastardos</div>
                <div class="al-header-sub">${ALLIANCES.bastardos.members}</div>
            </div>
            <div class="al-header-total">
                <div class="al-header-pts bastardos">${bPts.toFixed(0)}</div>
                <div class="al-header-avg">mÃ©dia ${bAvg.toFixed(1)}</div>
            </div>
        </div>
        ${bastardos.sort((a,b) => b.totalPoints - a.totalPoints).map(l => memberRow(l,'bastardos')).join('')}
    </div>

    <div class="al-vs-divider">â€” VS â€”</div>

    <div class="al-block">
        <div class="al-header-card anel">
            <div class="al-header-icon">ğŸ’</div>
            <div class="al-header-info">
                <div class="al-header-name anel">Sociedade do Anel</div>
                <div class="al-header-sub">${ALLIANCES.anel.members}</div>
            </div>
            <div class="al-header-total">
                <div class="al-header-pts anel">${aPts.toFixed(0)}</div>
                <div class="al-header-avg">mÃ©dia ${aAvg.toFixed(1)}</div>
            </div>
        </div>
        ${anel.sort((a,b) => b.totalPoints - a.totalPoints).map(l => memberRow(l,'anel')).join('')}
    </div>`;

    document.getElementById('aliancas-content').innerHTML = html;
}

function switchTab(name, btn) {
    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    document.getElementById(`tab-${name}`).classList.add('active');
    btn.classList.add('active');
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INICIALIZAR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded', async () => {
    try {
        const res = await fetch('dados.csv?v=' + Date.now());
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const csv = await res.text();
        const rows = parseCSV(csv);
        if (!rows.length) throw new Error('dados.csv vazio ou formato invÃ¡lido.');
        BATTLES = buildBattles(rows);

        const lastRound = Math.max(...BATTLES.map(b => b.week));
        const roundEl = document.getElementById('current-round');
        if (roundEl) roundEl.textContent = lastRound;

        renderRanking();
        renderAliancas();
        renderMedieval();
        renderBattles();
        renderAchievements();
        renderRules();
    } catch(err) {
        document.body.innerHTML = `
            <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;
                        min-height:100vh;padding:24px;text-align:center;background:#0d0d1a;">
                <div style="font-size:3em;margin-bottom:16px;">ğŸšï¸</div>
                <div style="font-family:Cinzel,serif;color:#e74c3c;font-size:1.2em;margin-bottom:12px;">
                    Erro ao carregar dados
                </div>
                <div style="color:#9988aa;font-size:0.95em;line-height:1.6;">
                    ${err.message}<br><br>
                    Verifique se <strong style="color:#DAA520">dados.csv</strong> estÃ¡ na mesma pasta que index.html.
                </div>
            </div>`;
        console.error(err);
    }
});

</script>
</body>
</html>
